<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="logo.png">
    <title>AI ph√¢n t√≠ch c·ª≠ ch·ªâ</title>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
</head>

<body>

<header>
    <a href="index.html" class="logo">Tr∆∞·ªùng THPT TR·∫¶N H∆ØNG ƒê·∫†O</a>
    <nav>
        <a href="index.html">Trang ch·ªß</a>
        <a href="camnang.html">C·∫©m nang</a>
        <a href="vechungtoi.html">V·ªÅ ch√∫ng t√¥i</a>
        <a href="ai.html" class="active">AI ph√¢n t√≠ch</a>
    </nav>
</header>

<div class="container">
    <h2 class="title">AI PH√ÇN T√çCH C·ª¨ CH·ªà T·ª™ ·∫¢NH</h2>

    <!-- Upload box -->
    <div class="upload-section">
        <label class="upload-box">
            <span>üì∑ Ch·ªçn ·∫£nh ƒë·ªÉ ph√¢n t√≠ch</span>
            <input type="file" id="imgInput" accept="image/*">
        </label>
    </div>

    <!-- Preview -->
    <img id="preview" class="preview-img"/>

    <button class="analyze-btn" onclick="analyzeImage()">üöÄ Ph√¢n t√≠ch</button>

    <h3 class="result-title">K·∫øt qu·∫£ AI</h3>
    <div id="result" class="result-box"></div>
</div>

<script>
    const OPENAI_API_KEY = "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";

    document.getElementById("imgInput").onchange = function () {
        const file = this.files[0];
        const img = document.getElementById("preview");
        img.src = URL.createObjectURL(file);
        img.style.display = "block";
    };

    async function analyzeImage() {
        const fileInput = document.getElementById("imgInput");
        const resultBox = document.getElementById("result");

        if (!fileInput.files[0]) {
            resultBox.innerText = "‚ö† Vui l√≤ng ch·ªçn ·∫£nh!";
            return;
        }

        resultBox.innerText = "‚è≥ ƒêang ph√¢n t√≠ch...";

        const file = fileInput.files[0];
        const base64 = await toBase64(file);

        const payload = {
            model: "gpt-4o-mini",
            messages: [
                {
                    role: "user",
                    content: [
                        { type: "text", text: "H√£y nh·∫≠n x√©t theo c√°c y·∫øu t·ªë: 1. T∆∞ th·∫ø; 2. Trang ph·ª•c; 3. N√©t m·∫∑t; 4. √Ånh m·∫Øt; 5. Phong th√°i. Ch·∫•m ƒëi·ªÉm 10 v√† g·ª£i √Ω ph√°t tri·ªÉn." },
                        { type: "image_url", image_url: { url: base64 } }
                    ]
                }
            ]
        };

        try {
            const res = await fetch("https://api.openai.com/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify(payload)
            });

            if (!res.ok) {
                resultBox.innerText = "‚ùå L·ªói API: " + res.statusText;
                return;
            }

            const data = await res.json();
            resultBox.innerText = data.choices[0].message.content;

        } catch (err) {
            resultBox.innerText = "‚ùå L·ªói k·∫øt n·ªëi ho·∫∑c CORS.\n" + err;
        }
    }

    function toBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    }
</script>

</body>
</html>


